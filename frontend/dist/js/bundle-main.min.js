(()=>{var T=()=>{let o=["https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1512820790803-83ca734da794?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1495446815901-a7297e633e8d?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1516979187457-637abb4f9353?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1497633762265-9d179a990aa6?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1519682577862-22b62b24e493?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1476275466078-4007374efbbe?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1550399105-c4db5fb85c18?w=150&h=200&fit=crop"];return o[Math.floor(Math.random()*o.length)]};function p(o,t,e,r=1,a){let n=T();return`
    <div class="card" data-id="${a}">
		<span class="badge-book-id">${a}</span>
		<span class="availability ${r?"available":"unavailable"}">
			${r?"Disponible":"Indisponible"}
		</span>
        <img src="${n}" width="170" height="200" alt="Book cover" />
        <h3 class="book-title">${o}</h3>
		<hr />

		<div class="book-info">
			<span class="author">${e}</span>

			<span class="published">Publi\xE9 en <span class="year">${t}</span></span>
		</div>
    </div>
    `}var S=window.location.hostname==="localhost"?"http://localhost:3000":"https://librairie-simple-production-6ca3.up.railway.app",g=S;var m=class{constructor(t,e){this.currentPage=1,this.totalPages=1,this.fetchFunction=t,this.renderFunction=e,this.leftBtn=document.getElementById("gauche"),this.rightBtn=document.getElementById("droite"),this.init()}init(){this.leftBtn.addEventListener("click",()=>this.goToPreviousPage()),this.rightBtn.addEventListener("click",()=>this.goToNextPage()),this.loadPage(this.currentPage)}async loadPage(t){try{let e=await this.fetchFunction(t),r,a;Array.isArray(e)?(console.warn("\u26A0\uFE0F API retourne l'ancien format (array). Mise \xE0 jour backend recommand\xE9e."),r=e,a={page:this.currentPage,totalPages:1,total:e.length,limit:e.length}):(r=e.data,a=e.pagination),this.currentPage=a.page,this.totalPages=a.totalPages,this.renderFunction(r),this.updateButtons()}catch(e){console.error("Erreur lors du chargement de la page :",e)}}goToPreviousPage(){this.currentPage>1&&this.loadPage(this.currentPage-1)}goToNextPage(){this.currentPage<this.totalPages&&this.loadPage(this.currentPage+1)}updateButtons(){this.leftBtn.disabled=this.currentPage===1,this.rightBtn.disabled=this.currentPage===this.totalPages}resetToFirstPage(){this.currentPage=1,this.loadPage(1),this.loadPage(1)}},f=m;var y=document.getElementById("container"),b=document.querySelector("input[type='search']"),$=document.querySelector(".search-bar button"),c=document.querySelector(".reset-search");$.addEventListener("click",()=>x());async function x(){try{c&&(c.style.display="flex");let o=b.value.trim();b.value="";let t=await i(1,o);l(t.data)}catch(o){console.error("Erreur lors de la recherche :",o),alert("Erreur lors de la recherche des livres")}}c.addEventListener("click",async()=>{try{c.style.display="none";let o=await i(1);l(o.data)}catch(o){console.error("Erreur lors de la r\xE9initialisation de la recherche :",o),alert("Erreur lors de la r\xE9initialisation de la recherche des livres")}});function A(){document.querySelectorAll(".card").forEach(t=>{t.addEventListener("click",e=>{let r=t.dataset.id,a=t.querySelector(".book-title").textContent,n=t.querySelector(".author").textContent,h=t.querySelector(".year").textContent,s={id:r,title:a,author:n,year:h};console.log(s);let d=document.getElementById("book-dialog"),P=document.getElementById("close-dialog"),w=document.getElementById("save-book");d.showModal(),P.onclick=()=>{d.close()},document.getElementById("book-title").value=s.title,document.getElementById("book-author").textContent=s.author,document.getElementById("book-year").value=s.year,w.onclick=async v=>{v.preventDefault();let k=document.getElementById("book-title").value,E=document.getElementById("book-author").value,B=document.getElementById("book-year").value;try{let u=await q(s.id,k,E,B);console.log("Livre mis \xE0 jour :",u);let I=parseInt(new URLSearchParams(window.location.search).get("page"))||1,L=await i(I);l(L.data),alert("Livre mis \xE0 jour avec succ\xE8s !")}catch(u){console.error("Erreur lors de la mise \xE0 jour du livre :",u)}d.close()}})})}async function i(o=1,t=""){try{let e=new URLSearchParams({page:o,limit:6,...t&&{searched:t}}),r=await fetch(`${g}/api/books?${e.toString()}`);if(!r.ok)throw new Error(`Erreur HTTP: ${r.status}`);return await r.json()}catch(e){throw console.error("Erreur lors de la r\xE9cup\xE9ration des livres :",e),e}}async function q(o,t,e,r){try{let a=await fetch(`${g}/api/books/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,author:e,year:r})});if(!a.ok)throw alert("Erreur API"),new Error("Erreur API");return await a.json()}catch(a){throw console.error("Erreur serveur :",a),alert("Erreur lors de la mise \xE0 jour du livre"),a}}function l(o){y.innerHTML="",o.forEach(t=>{let e=t.title,r=t.year,a=t.full_name,n=t.available,h=t.id,s=p(e,r,a,n,h);y.innerHTML+=s}),A()}new f(i,l);})();
