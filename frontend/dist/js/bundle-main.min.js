var q=()=>{let t=["https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1512820790803-83ca734da794?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1495446815901-a7297e633e8d?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1516979187457-637abb4f9353?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1497633762265-9d179a990aa6?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1519682577862-22b62b24e493?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1476275466078-4007374efbbe?w=150&h=200&fit=crop","https://images.unsplash.com/photo-1550399105-c4db5fb85c18?w=150&h=200&fit=crop"];return t[Math.floor(Math.random()*t.length)]};function g(t,e,o,a=1,r){let s=q();return`
    <div class="card" data-id="${r}">
		<span class="badge-book-id">${r}</span>
		<span class="availability ${a?"available":"unavailable"}">
			${a?"Disponible":"Indisponible"}
		</span>
        <img src="${s}" width="170" height="200" alt="Book cover" />
        <h3 class="book-title">${t}</h3>
		<hr />

		<div class="book-info">
			<span class="author">${o}</span>

			<span class="published">Publi\xE9 en <span class="year">${e}</span></span>
		</div>
    </div>
    `}var j=window.location.hostname==="localhost"?"http://localhost:3000":"https://librairie-simple-production-6ca3.up.railway.app",l=j;var f=class{constructor(e,o){this.currentPage=1,this.totalPages=1,this.fetchFunction=e,this.renderFunction=o,this.leftBtn=document.getElementById("gauche"),this.rightBtn=document.getElementById("droite"),this.init()}init(){this.leftBtn.addEventListener("click",()=>this.goToPreviousPage()),this.rightBtn.addEventListener("click",()=>this.goToNextPage()),this.loadPage(this.currentPage)}async loadPage(e){try{let o=await this.fetchFunction(e),a,r;Array.isArray(o)?(console.warn("\u26A0\uFE0F API retourne l'ancien format (array). Mise \xE0 jour backend recommand\xE9e."),a=o,r={page:this.currentPage,totalPages:1,total:o.length,limit:o.length}):(a=o.data,r=o.pagination),this.currentPage=r.page,this.totalPages=r.totalPages,this.renderFunction(a),this.updateButtons()}catch(o){console.error("Erreur lors du chargement de la page :",o)}}goToPreviousPage(){this.currentPage>1&&this.loadPage(this.currentPage-1)}goToNextPage(){this.currentPage<this.totalPages&&this.loadPage(this.currentPage+1)}updateButtons(){this.leftBtn.disabled=this.currentPage===1,this.rightBtn.disabled=this.currentPage===this.totalPages}resetToFirstPage(){this.currentPage=1,this.loadPage(1),this.loadPage(1)}},b=f;async function v(){let t=localStorage.getItem("userId");if(!t)return!1;try{let e=await fetch(`/api/auth/${t}`);if(!e.ok)throw new Error("Erreur lors de la v\xE9rification de l'authentification");let o=await e.json();return console.log("Donn\xE9es d'authentification re\xE7ues :",o),{isAuth:o.isAuth,user:o.result}}catch(e){return console.error("Erreur lors de la v\xE9rification de l'authentification :",e),!1}}var c=await v(),C=document.querySelector(".auth-field"),M=document.querySelector(".user-menu"),w=document.querySelector(".main-container span"),y=!!(c&&c.user),k=c&&c.user?c.user.username:void 0;C.style.display=y?"none":"flex";M.style.display=y?"inline-block":"none";w&&y&&(w.textContent=k?`Ta gueule ${k} !`:"Donc faudrait la fermer un moment..");var E=document.getElementById("container"),P=document.querySelector("input[type='search']"),U=document.querySelector(".search-bar button"),u=document.querySelector(".reset-search");document.getElementById("user-menu-button").addEventListener("click",()=>{let t=document.getElementById("user-menu-options");if(!t)return;t.style.display=t.style.display==="block"?"none":"block";let e=o=>{!t.contains(o.target)&&o.target.id!=="user-menu-button"&&(t.style.display="none",document.removeEventListener("click",e))};t.style.display==="block"&&(document.addEventListener("click",e),document.getElementById("logout-button").addEventListener("click",async()=>{if(confirm("\xCAtes-vous s\xFBr de vouloir vous d\xE9connecter ? (Tout progr\xE8s sera perdu)")){let r=localStorage.getItem("userId");if(!r){alert("Impossible de trouver l'ID utilisateur pour la d\xE9connexion.");return}let s=await fetch(`${l}/api/auth/logout/${r}`,{method:"POST",credentials:"include"});if(!s.ok){alert("Erreur lors de la d\xE9connexion.");return}let i=await s.json();alert(i.message),console.log(i.message),localStorage.removeItem("userId"),localStorage.removeItem("username"),localStorage.removeItem("role"),window.location.href="/"}}))});U.addEventListener("click",()=>D());async function D(){try{u&&(u.style.display="flex");let t=P.value.trim();P.value="";let e=await d(1,t);h(e.data)}catch(t){console.error("Erreur lors de la recherche :",t),alert("Erreur lors de la recherche des livres")}}u.addEventListener("click",async()=>{try{u.style.display="none";let t=await d(1);h(t.data)}catch(t){console.error("Erreur lors de la r\xE9initialisation de la recherche :",t),alert("Erreur lors de la r\xE9initialisation de la recherche des livres")}});function F(){document.querySelectorAll(".card").forEach(e=>{e.addEventListener("click",o=>{let a=e.dataset.id,r=e.querySelector(".book-title").textContent,s=e.querySelector(".author").textContent,i=e.querySelector(".year").textContent,n={id:a,title:r,author:s,year:i};console.log(n);let p=document.getElementById("book-dialog"),I=document.getElementById("close-dialog"),B=document.getElementById("save-book");p.showModal(),I.onclick=()=>{p.close()},document.getElementById("book-title").value=n.title,document.getElementById("book-author").textContent=n.author,document.getElementById("book-year").value=n.year,B.onclick=async L=>{L.preventDefault();let S=document.getElementById("book-title").value,T=document.getElementById("book-author").value,$=document.getElementById("book-year").value;try{let m=await R(n.id,S,T,$);console.log("Livre mis \xE0 jour :",m);let x=parseInt(new URLSearchParams(window.location.search).get("page"))||1,A=await d(x);h(A.data),alert("Livre mis \xE0 jour avec succ\xE8s !")}catch(m){console.error("Erreur lors de la mise \xE0 jour du livre :",m)}p.close()}})})}async function d(t=1,e=""){try{let o=new URLSearchParams({page:t,limit:6,...e&&{searched:e}}),a=await fetch(`${l}/api/books?${o.toString()}`);if(!a.ok)throw new Error(`Erreur HTTP: ${a.status}`);return await a.json()}catch(o){throw console.error("Erreur lors de la r\xE9cup\xE9ration des livres :",o),o}}async function R(t,e,o,a){try{let r=await fetch(`${l}/api/books/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,author:o,year:a})});if(!r.ok)throw alert("Erreur API"),new Error("Erreur API");return await r.json()}catch(r){throw console.error("Erreur serveur :",r),alert("Erreur lors de la mise \xE0 jour du livre"),r}}function h(t){E.innerHTML="",t.forEach(e=>{let o=e.title,a=e.year,r=e.full_name,s=e.available,i=e.id,n=g(o,a,r,s,i);E.innerHTML+=n}),F()}new b(d,h);
