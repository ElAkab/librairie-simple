var w=window.location.hostname==="localhost"?"http://localhost:3000":"https://librairie-simple-production-6ca3.up.railway.app",i=w;var c=class{constructor(r,e){this.currentPage=1,this.totalPages=1,this.fetchFunction=r,this.renderFunction=e,this.leftBtn=document.getElementById("gauche"),this.rightBtn=document.getElementById("droite"),this.init()}init(){this.leftBtn.addEventListener("click",()=>this.goToPreviousPage()),this.rightBtn.addEventListener("click",()=>this.goToNextPage()),this.loadPage(this.currentPage)}async loadPage(r){try{let e=await this.fetchFunction(r),o,n;Array.isArray(e)?(console.warn("\u26A0\uFE0F API retourne l'ancien format (array). Mise \xE0 jour backend recommand\xE9e."),o=e,n={page:this.currentPage,totalPages:1,total:e.length,limit:e.length}):(o=e.data,n=e.pagination),this.currentPage=n.page,this.totalPages=n.totalPages,this.renderFunction(o),this.updateButtons()}catch(e){console.error("Erreur lors du chargement de la page :",e)}}goToPreviousPage(){this.currentPage>1&&this.loadPage(this.currentPage-1)}goToNextPage(){this.currentPage<this.totalPages&&this.loadPage(this.currentPage+1)}updateButtons(){this.leftBtn.disabled=this.currentPage===1,this.rightBtn.disabled=this.currentPage===this.totalPages}resetToFirstPage(){this.currentPage=1,this.loadPage(1),this.loadPage(1)}},p=c;async function y(){let t=localStorage.getItem("userId");if(!t)return!1;try{let r=await fetch(`/api/auth/${t}`);if(!r.ok)throw new Error("Erreur lors de la v\xE9rification de l'authentification");let e=await r.json();return console.log("Donn\xE9es d'authentification re\xE7ues :",e),{isAuth:e.isAuth,user:e.result}}catch(r){return console.error("Erreur lors de la v\xE9rification de l'authentification :",r),!1}}var a=await y(),b=document.querySelector(".auth-field"),B=document.querySelector(".user-menu"),v=document.querySelector(".main-container span"),d=!!(a&&a.user),P=a&&a.user?a.user.username:void 0;b.style.display=d?"none":"flex";B.style.display=d?"inline-block":"none";v&&d&&(v.textContent=P?`Ta gueule ${P} !`:"Donc faudrait la fermer un moment..");document.getElementById("user-menu-button").addEventListener("click",()=>{let t=document.getElementById("user-menu-options");if(!t)return;t.style.display=t.style.display==="block"?"none":"block";let r=e=>{!t.contains(e.target)&&e.target.id!=="user-menu-button"&&(t.style.display="none",document.removeEventListener("click",r))};t.style.display==="block"&&(document.addEventListener("click",r),document.getElementById("logout-button").addEventListener("click",async()=>{if(confirm("\xCAtes-vous s\xFBr de vouloir vous d\xE9connecter ? (Tout progr\xE8s sera perdu)")){let n=localStorage.getItem("userId");if(!n){alert("Impossible de trouver l'ID utilisateur pour la d\xE9connexion.");return}let m=await fetch(`${i}/api/auth/logout/${n}`,{method:"POST",credentials:"include"});if(!m.ok){alert("Erreur lors de la d\xE9connexion.");return}let f=await m.json();alert(f.message),console.log(f.message),localStorage.removeItem("userId"),localStorage.removeItem("username"),localStorage.removeItem("role"),window.location.href="/"}}))});var l=document.getElementById("authors-field"),E=document.querySelector("input[type='search']"),L=document.querySelector(".search-bar button"),s=document.querySelector(".reset-search");L.addEventListener("click",()=>k());async function k(){try{s&&(s.style.display="flex");let t=E.value.trim();E.value="";let r=await h(1,t);g(r.data)}catch(t){console.error("Erreur lors de la recherche :",t),alert("Erreur lors de la recherche des auteurs")}}s.addEventListener("click",async()=>{try{s.style.display="none";let t=await h(1);g(t.data),S.resetToFirstPage()}catch(t){console.error("Erreur lors de la r\xE9initialisation de la recherche :",t),alert("Erreur lors de la r\xE9initialisation de la recherche des auteurs")}});async function h(t=1,r=""){try{let e=new URLSearchParams({page:t,limit:6,...r&&{searched:r}}),o=await fetch(`${i}/api/authors?${e.toString()}`);if(!o.ok)throw new Error("Erreur avec l'API");return await o.json()}catch(e){return console.error("Erreur lors de la r\xE9cup\xE9ration des auteurs :",e),l.innerHTML="<h1>Une erreur est survenue :/</h1>",{data:[],total:0,page:1,limit:6}}}function g(t){l.innerHTML="",t.forEach(r=>{let e=`
			<div class="author-card">
				<span id="badge-author-id">${r.id}</span>
				<h2>${r.full_name}</h2>
				<hr />
				<div class="author-details">
					<div><strong>Nationalit\xE9 :</strong></div>
					<div>${r.nationality}</div>
				</div>
				<div class="author-details">
					<div><strong>Naissance :</strong></div>
					<div>${r.birth_year}</div>
				</div>
			</div>
		`;l.innerHTML+=e})}var S=new p(h,g),u=document.getElementById("modal"),I=u?.querySelector("form");u&&I&&u.addEventListener("submit",t=>{t.preventDefault();let r=new FormData(I),e={nationality:r.getAll("nationality"),birthYear:r.getAll("birth_year")};console.log(e)});
