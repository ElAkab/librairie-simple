(()=>{var i=window.location.hostname==="localhost"?"http://localhost:3000":"https://librairie-simple-production-6ca3.up.railway.app",s=i;var c=document.querySelectorAll(".add");c.forEach(r=>{r.addEventListener("submit",async e=>{e.preventDefault();let t=new FormData(r),a=Object.fromEntries(t.entries());if(r.classList.contains("add-author")){if(await h(a.fullName,a.birthYear)){alert(`Un auteur "${a.fullName}" (${a.birthYear}) existe d\xE9j\xE0 dans la base de donn\xE9es.`);return}await l(a)&&(alert("\u2705 Auteur cr\xE9\xE9 avec succ\xE8s !"),r.reset())}else if(r.classList.contains("add-book")){if(await p(a.title,a.authorId)){alert(`Le livre "${a.title}" existe d\xE9j\xE0 pour cet auteur dans la base de donn\xE9es.`);return}await u(a)&&(alert("\u2705 Livre cr\xE9\xE9 avec succ\xE8s !"),r.reset())}else if(r.classList.contains("add-loan")){if((await w(a.bookId)).length===0){alert("Le livre n'est pas disponible pour l'emprunt. Veuillez choisir un autre livre.");return}await d(a)&&(alert("\u2705 Emprunt cr\xE9\xE9 avec succ\xE8s !"),r.reset())}else console.log("Formulaire non reconnu");console.log("Form data submitted:",a)})});async function l(r){try{let e={full_name:r.fullName,birth_year:r.birthYear,nationality:r.nationality},t=await fetch(`${s}/api/authors`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Erreur API");return await t.json()}catch(e){console.error("Erreur serveur",e),alert("Auteur : Erreur")}}async function u(r){try{let e={title:r.title,authorId:r.authorId,year:r.publicationYear},t=await fetch(`${s}/api/books`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let o=await t.json();throw new Error(o.message||"Erreur API")}return await t.json()}catch(e){console.error("Erreur serveur",e),alert("Livre : Erreur")}}async function d(r){try{let e={book_id:r.bookId,borrower_name:r.borrowerName,borrowed_date:r.fromDate,return_date:r.toDate||null},t=await fetch(`${s}/api/loans`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let o=await t.json();throw new Error(o.message||"Erreur API")}return await t.json()}catch(e){console.error("Erreur serveur",e),alert("Emprunt : "+e.message)}}async function h(r,e){try{let t=await fetch(`${s}/api/authors`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Erreur API");return(await t.json()).some(o=>o.full_name.toLowerCase()===r.toLowerCase()&&o.birth_year==e)}catch(t){return console.error("Erreur serveur",t),!1}}async function p(r,e){try{let t=await fetch(`${s}/api/books`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Erreur API");return(await t.json()).some(o=>o.title.toLowerCase()===r.toLowerCase()&&o.author_id==e)}catch(t){return console.error("Erreur serveur",t),!1}}async function w(r){try{let e=await fetch(`${s}/api/books/available/${r}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Erreur API");return await e.json()}catch(e){console.error("Erreur serveur",e),alert("R\xE9cup\xE9ration des livres disponibles : Erreur")}}})();
